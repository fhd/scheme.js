var scheme=typeof exports!="undefined"?exports:{};(function(a){function e(a,b){var c;for(c=0;c<a.length;c++)b(a[c])}function f(a,c){return b.begin.apply(null,[a,null].concat(Array.prototype.slice.call(c,3)))}function g(a){return a.replace(/;.*/g,"")}function h(a){return a.match(/("[^"]*"|[()]|[^\s()]+)/g)}function i(b){var c=b[0],d=b.length-1,e=b[d],f,g;if(c==='"'||e==='"'){if(c!==e)throw"Unexpected EOF while reading string";return b.substring(1,d)}if(c==="#"){f=b.substring(1);if(f==="t")return!0;if(f==="f")return!1;throw"Not a valid boolean literal: "+f}return g=parseFloat(b),isNaN(g)?new a.Symbol(b):g}function j(b,c){return l(c)?c.length?[b].concat(c):[b]:c instanceof d?[b].concat(c.car,new a.Symbol("."),c.cdr):new d(b,c)}function k(b){var c,d,e,f;if(b.length===0)throw"Unexpected EOF while reading";c=b[0],b.shift();if(c==="'")return[new a.Symbol("quote"),k(b)];if(c==="("){f=[];while(b[0]!==")")f.push(k(b));b.shift();for(e=0;e<f.length;e++)if(f[e].toString()==="."){if(e===0||e!==f.length-2)throw"Invalid dotted list";if(f.length===3)return j(f[0],f[2]);break}return f}if(c===")")throw"Unexpected )";return i(c)}function l(a){return Object.prototype.toString.call(a)==="[object Array]"}function m(a,b){var c=[],d;for(d=0;d<a.length;d++)c.push(b(a[d]));return c}function n(b,d){var e=b[0].toString().substring(1),f=b[1],g,h,i;return f instanceof a.Symbol?(g=f.toString(),h=g==="js"?this:q(f,d)||this.eval(g)):h=f,i=r(b.slice(2),d),new c(h,e)}function o(a){return a&&{}.toString.call(a)==="[object Function]"}function p(a,b){var d=b?r(a,b):a,e=d[0];if(!e)throw a[0]+" is not a procedure";return d.shift(),e instanceof c?e.get().apply(e.object,d):e.apply(null,d)}function q(c,d){var e,f,g,h;return c instanceof a.Symbol?(e=c.toString(),e[0]==="'"?new a.Symbol(e.substring(1)):d.get(e)):l(c)?(f=c[0],f instanceof a.Symbol&&f.toString()[0]==="."?n(c,d):(h=b[f],h?h.apply(null,[d].concat(c)):p(c,d))):c}function r(a,b){return m(a,function(a){return q(a,b)})}function s(b){var c;return typeof b=="string"?'"'+b+'"':typeof b=="boolean"?b?"#t":"#f":b instanceof a.Symbol?b.toString():l(b)?(c="(",b.forEach(function(a){c.length>1&&(c+=" "),c+=s(a)}),c+")"):o(b)?"#procedure":typeof b=="object"?JSON.stringify(b):b}function t(a,b){var c;window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLHTTP")),c.onreadystatechange=function(){if(c.readyState!==4)return;var d=c.status;if(d!==0&&d!==200)throw"Unable to load scheme script from: "+a+", status: "+statusText;b(c.responseText)},c.open("GET",a),c.send()}var b={"if":function(a,b,c,d,e){return q(q(c,a)?d:e,a)},define:function(c,d,e,f){var g,h,i;if(!l(e)){c.set(e,q(f,c));return}g=e[0],h=e.slice(1),i=[new a.Symbol("begin")].concat(Array.prototype.slice.call(arguments,3)),c.set(g,b.lambda(c,d,h,i))},"set!":function(d,e,f,g){var h;if(f instanceof a.Symbol){h=f.toString();if(!d.get(h))throw"Unbound variable: "+h;d.set(h,g)}else f instanceof c?f.set(g):b["set!"](d,e,q(f,d),g)},lambda:function(b,c,d,e){return function(){var c,f;if(arguments.length!==d.length)throw"Invalid number of arguments. Expected "+d.length+", got "+arguments.length;c={};for(f=0;f<d.length;f++)c[d[f]]=q(arguments[f],b);return q(e,new a.Environment(c,b))}},quote:function(a,b,c){return c},begin:function(a){var b;return e(Array.prototype.slice.call(arguments,2),function(c){b=q(c,a)}),b},and:function(a,b,c,d){return q(c,a)&&q(d,a)},or:function(a,b,c,d){return q(c,a)||q(d,a)},let:function(b,c,d){var g={};return e(d,function(a){g[a[0]]=q(a[1],b)}),f(new a.Environment(g,b),arguments)},"let*":function(b,c,d){var g={},h;return e(d,function(c){g[c[0]]=q(c[1],h),h=new a.Environment(g,b)}),f(h,arguments)}},c=function(a,b){this.object=a,this.property=b},d=function(a,b){this.car=a,this.cdr=b};c.prototype={get:function(){return this.object[this.property]},set:function(a){this.object[this.property]=a},toString:function(){return this.get().toString()}},a.Environment=function(a,b){var c;this.entries=a||{},this.outer=b||null,!a&&!b&&(this.entries={"=":function(a,b){return a===b},"string-append":function(){var a="";return e(arguments,function(b){a+=b}),a},cons:j,apply:function(a,b){return p([a].concat(b))},"make-object":function(a){var b={};return e(a,function(a){b[a[0]]=a[1]}),b}},c=this,e(["+","-","*","/",">","<",">=","<="],function(a){c.entries[a]=function(b,c){return this.eval(b+a+c)}}))},a.Environment.prototype={get:function(a){return this.entries[a]||(this.outer?this.outer.get(a):null)},set:function(a,b){this.entries[a]=b}},a.Symbol=function(a){this.s=a},a.Symbol.prototype={toString:function(){return this.s}},a.read=function(a){var b=h(g(a)),c=[];while(b.length)c.push(k(b));return c},a.eval=function(a,b){return m(r(a,b),function(a){return a instanceof c?a.get():a})},a.print=function(a){var b="";return e(a,function(a){b+=s(a)+"\n"}),b},typeof window!="undefined"&&(window.onload=function(){var b=document.getElementsByTagName("script");e(b,function(b){if(b.type!=="text/scheme")return;b.src.length?t(b.src,function(b){a.eval(a.read(b))}):a.eval(b.innerHTML)})})})(scheme);