var scheme=function(a){function d(a){return a.replace(/;.*/g,"")}function e(a){return a.match(/("[^"]*"|[()]|[^\s()]+)/g)}function f(b){var c=b[0],d=b.length-1,e=b[d],f,g;if(c==='"'||e==='"'){if(c!==e)throw"Unexpected EOF while reading string";return b.substring(1,d)}if(c==="#"){f=b.substring(1);if(f==="t")return!0;if(f==="f")return!1;throw"Not a valid boolean literal: "+f}return g=parseFloat(b),isNaN(g)?new a.Symbol(b):g}function g(b,c){var d,e,h;if(b.length===0)throw"Unexpected EOF while reading";d=b[0],b.shift();if(d==="'")return[new a.Symbol("quote"),g(b,c)];if(d==="`")return[new a.Symbol("quasiquote"),g(b,!0)];if(d===",")return[new a.Symbol("unquote"),g(b,c)];if(d==="("){e=[];while(b[0]!==")")e.push(g(b,c));b.shift();for(h=0;h<e.length;h++)if(e[h].toString()==="."){if(h===0||h!==e.length-2)throw"Invalid dotted list";if(e.length===3)return c?new a.Pair(e[0],e[2]):a.standardProcedures.cons(e[0],e[2]);break}return e}if(d===")")throw"Unexpected )";return f(d)}function h(b,d){var e=b[0].toString().substring(1),f=b[1],g,h,j;return f instanceof a.Symbol?(g=f.toString(),h=g==="js"?this:i(f,d)||this.eval(g)):h=i(f,d),j=k(b.slice(2),d),new c(h,e)}function i(c,d){var e,f,g;return c instanceof a.Symbol?(e=c.toString(),e[0]==="'"?new a.Symbol(e.substring(1)):d.get(e)):a.utils.isArray(c)?(f=c[0],f instanceof a.Symbol&&f.toString()[0]==="."?h(c,d):(g=b[f],g?g.apply(null,[d].concat(c)):a.callProcedure(c,d))):c}function j(a,c){return b.begin.apply(null,[a,null].concat(Array.prototype.slice.call(c,3)))}function k(b,c){return a.utils.map(b,function(a){return i(a,c)})}function l(b){var c;return typeof b=="string"?'"'+b+'"':typeof b=="boolean"?b?"#t":"#f":b instanceof a.Symbol?b.toString():a.utils.isArray(b)?(c="(",a.utils.forEach(b,function(a){c.length>1&&(c+=" "),c+=l(a)}),c+")"):a.utils.isFunction(b)?"#procedure":typeof b=="object"?JSON.stringify(b):b}var b={"if":function(a,b,c,d,e){return i(i(c,a)?d:e,a)},define:function(c,d,e,f){var g,h,j;if(!a.utils.isArray(e)){c.define(e,i(f,c));return}g=e[0],h=e.slice(1),j=[new a.Symbol("begin")].concat(Array.prototype.slice.call(arguments,3)),c.define(g,b.lambda(c,d,h,j))},"set!":function(d,e,f,g){var h;if(f instanceof a.Symbol){h=f.toString();if(typeof d.get(h)=="undefined")throw"Unbound variable: "+h;d.set(h,g)}else f instanceof c?f.set(g):b["set!"](d,e,i(f,d),g)},lambda:function(b,c,d,e){return function(){var c={},f;for(f=0;f<Math.min(d.length,arguments.length);f++)c[d[f]]=i(arguments[f],b);return i(e,new a.Environment(c,b))}},quote:function(a,b,c){return c},quasiquote:function(b,c,d){function e(b,c){var d;return b instanceof a.Pair?new a.Pair(e(b.car,c),e(b.cdr,c)):!a.utils.isArray(b)||!b.length?b:(d=b[0],d instanceof a.Symbol&&d.toString()==="unquote"?i(b[1],c):a.utils.map(b,function(a){return e(a,c)}))}return e(d,b)},begin:function(b){var c;return a.utils.forEach(Array.prototype.slice.call(arguments,2),function(a){c=i(a,b)}),c},and:function(a,b,c,d){return i(c,a)&&i(d,a)},or:function(a,b,c,d){return i(c,a)||i(d,a)},let:function(b,c,d){var e={};return a.utils.forEach(d,function(a){e[a[0]]=i(a[1],b)}),j(new a.Environment(e,b),arguments)},"let*":function(b,c,d){var e={},f;return a.utils.forEach(d,function(c){e[c[0]]=i(c[1],f),f=new a.Environment(e,b)}),j(f,arguments)},"try":function(a,b,c,d){try{return i(c,a)}catch(e){if(!d)throw e;var f=i(d,a);return f(e)}}},c=function(a,b){this.object=a,this.property=b};return c.prototype={get:function(){return this.object[this.property]},set:function(a){this.object[this.property]=a},toString:function(){return this.get().toString()}},a.Environment=function(b,c){this.entries=b||{},this.outer=c||null,!b&&!c&&(this.entries=a.standardProcedures,this.entries.js=this)},a.Environment.prototype={get:function(a){var b=this.entries[a];return typeof b!="undefined"?b:this.outer?this.outer.get(a):undefined},define:function(a,b){this.entries[a]=b},set:function(a,b){this.outer&&typeof this.outer.get(a)!="undefined"?this.outer.set(a,b):this.define(a,b)}},a.Symbol=function(a){this.s=a},a.Symbol.prototype={toString:function(){return this.s}},a.Pair=function(a,b){this.car=a,this.cdr=b},a.read=function(a){var b=e(d(a)),c=[];while(b.length)c.push(g(b));return c},a.callProcedure=function(a,b){var d=b?k(a,b):a,e=d[0];if(!e)throw a[0]+" is not a procedure";return d.shift(),e instanceof c?e.get().apply(e.object,d):e.apply(null,d)},a.eval=function(b,d){return a.utils.map(k(b,d||new a.Environment),function(a){return a instanceof c?a.get():a})},a.load=function(b,c){return a.eval(a.read(b),c)},a.print=function(b){var c="";return a.utils.forEach(b,function(a){c+=l(a)+"\n"}),c},typeof window!="undefined"&&(window.onload=function(){var b=document.getElementsByTagName("script");a.utils.forEach(b,function(b){if(b.type!=="text/x-scheme")return;b.src.length?a.utils.httpGet(b.src,function(b){a.load(b)}):a.load(b.innerHTML)})}),a}(typeof exports!="undefined"?exports:{});scheme.utils=function(a){return{forEach:function(a,b){var c;for(c=0;c<a.length;c++)b(a[c])},map:function(a,b){var c=[],d;for(d=0;d<a.length;d++)c.push(b(a[d]));return c},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},isFunction:function(a){return a&&{}.toString.call(a)==="[object Function]"},httpGet:function(a,b){var c;window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLHTTP")),c.onreadystatechange=function(){if(c.readyState!==4)return;var d=c.status;if(d!==0&&d!==200)throw"Unable to load scheme script from: "+a+", status: "+statusText;b(c.responseText)},c.open("GET",a),c.send()}}}(scheme),scheme.standardProcedures=function(a){return{"=":function(a,b){return a===b},">":function(a,b){return a>b},"<":function(a,b){return a<b},">=":function(a,b){return a>=b},"<=":function(a,b){return a<=b},"+":function(){var b=0;return a.utils.forEach(arguments,function(a){b+=a}),b},"-":function(){var b=arguments[0];return arguments.length===1?-b:(a.utils.forEach(Array.prototype.slice.call(arguments,1),function(a){b-=a}),b)},"*":function(){var b=1;return a.utils.forEach(arguments,function(a){b*=a}),b},"/":function(){var b=arguments[0];return arguments.length===1?1/b:(a.utils.forEach(Array.prototype.slice.call(arguments,1),function(a){b/=a}),b)},"string-append":function(){var b="";return a.utils.forEach(arguments,function(a){b+=a}),b},cons:function(b,c){return a.utils.isArray(c)?c.length?[b].concat(c):[b]:c instanceof a.Pair?[b].concat(c.car,new a.Symbol("."),c.cdr):new a.Pair(b,c)},apply:function(b,c){return a.callProcedure([b].concat(c))},"new":function(){var a,b,c;this.schemeTemp={constructor:arguments[0].get(),args:Array.prototype.slice.call(arguments,1)},a="new this.schemeTemp.constructor(";for(b=0;b<this.schemeTemp.args.length;b++)b>0&&(a+=","),a+="this.schemeTemp.args["+b+"]";return a+=");",c=this.eval(a),delete this.schemeTemp,c},"make-object":function(b){var c={};return a.utils.forEach(b,function(a){c[a.car]=a.cdr}),c}}}(scheme);