var scheme=typeof exports!="undefined"?exports:{};(function(a){function e(a,b){var c;for(c=0;c<a.length;c++)b(a[c])}function f(a,c){return b.begin.apply(null,[a,null].concat(Array.prototype.slice.call(c,3)))}function g(a){return a.replace(/;.*/g,"")}function h(a){return a.match(/("[^"]*"|[()]|[^\s()]+)/g)}function i(b){var c=b[0],d=b.length-1,e=b[d],f,g;if(c==='"'||e==='"'){if(c!==e)throw"Unexpected EOF while reading string";return b.substring(1,d)}if(c==="#"){f=b.substring(1);if(f==="t")return!0;if(f==="f")return!1;throw"Not a valid boolean literal: "+f}return g=parseFloat(b),isNaN(g)?new a.Symbol(b):g}function j(b,c){return l(c)?c.length?[b].concat(c):[b]:c instanceof d?[b].concat(c.car,new a.Symbol("."),c.cdr):new d(b,c)}function k(b,c){var e,f,g;if(b.length===0)throw"Unexpected EOF while reading";e=b[0],b.shift();if(e==="'")return[new a.Symbol("quote"),k(b,c)];if(e==="`")return[new a.Symbol("quasiquote"),k(b,!0)];if(e===",")return[new a.Symbol("unquote"),k(b,c)];if(e==="("){f=[];while(b[0]!==")")f.push(k(b,c));b.shift();for(g=0;g<f.length;g++)if(f[g].toString()==="."){if(g===0||g!==f.length-2)throw"Invalid dotted list";if(f.length===3)return c?new d(f[0],f[2]):j(f[0],f[2]);break}return f}if(e===")")throw"Unexpected )";return i(e)}function l(a){return Object.prototype.toString.call(a)==="[object Array]"}function m(a,b){var c=[],d;for(d=0;d<a.length;d++)c.push(b(a[d]));return c}function n(b,d){var e=b[0].toString().substring(1),f=b[1],g,h,i;return f instanceof a.Symbol?(g=f.toString(),h=g==="js"?this:q(f,d)||this.eval(g)):h=q(f,d),i=r(b.slice(2),d),new c(h,e)}function o(a){return a&&{}.toString.call(a)==="[object Function]"}function p(a,b){var d=b?r(a,b):a,e=d[0];if(!e)throw a[0]+" is not a procedure";return d.shift(),e instanceof c?e.get().apply(e.object,d):e.apply(null,d)}function q(c,d){var e,f,g;return c instanceof a.Symbol?(e=c.toString(),e[0]==="'"?new a.Symbol(e.substring(1)):d.get(e)):l(c)?(f=c[0],f instanceof a.Symbol&&f.toString()[0]==="."?n(c,d):(g=b[f],g?g.apply(null,[d].concat(c)):p(c,d))):c}function r(a,b){return m(a,function(a){return q(a,b)})}function s(b){var c;return typeof b=="string"?'"'+b+'"':typeof b=="boolean"?b?"#t":"#f":b instanceof a.Symbol?b.toString():l(b)?(c="(",b.forEach(function(a){c.length>1&&(c+=" "),c+=s(a)}),c+")"):o(b)?"#procedure":typeof b=="object"?JSON.stringify(b):b}function t(a,b){var c;window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLHTTP")),c.onreadystatechange=function(){if(c.readyState!==4)return;var d=c.status;if(d!==0&&d!==200)throw"Unable to load scheme script from: "+a+", status: "+statusText;b(c.responseText)},c.open("GET",a),c.send()}var b={"if":function(a,b,c,d,e){return q(q(c,a)?d:e,a)},define:function(c,d,e,f){var g,h,i;if(!l(e)){c.define(e,q(f,c));return}g=e[0],h=e.slice(1),i=[new a.Symbol("begin")].concat(Array.prototype.slice.call(arguments,3)),c.define(g,b.lambda(c,d,h,i))},"set!":function(d,e,f,g){var h;if(f instanceof a.Symbol){h=f.toString();if(typeof d.get(h)=="undefined")throw"Unbound variable: "+h;d.set(h,g)}else f instanceof c?f.set(g):b["set!"](d,e,q(f,d),g)},lambda:function(b,c,d,e){return function(){var c={},f;for(f=0;f<Math.min(d.length,arguments.length);f++)c[d[f]]=q(arguments[f],b);return q(e,new a.Environment(c,b))}},quote:function(a,b,c){return c},quasiquote:function(b,c,e){function f(b,c){var e;return b instanceof d?new d(f(b.car,c),f(b.cdr,c)):!l(b)||!b.length?b:(e=b[0],e instanceof a.Symbol&&e.toString()==="unquote"?q(b[1],c):m(b,function(a){return f(a,c)}))}return f(e,b)},begin:function(a){var b;return e(Array.prototype.slice.call(arguments,2),function(c){b=q(c,a)}),b},and:function(a,b,c,d){return q(c,a)&&q(d,a)},or:function(a,b,c,d){return q(c,a)||q(d,a)},let:function(b,c,d){var g={};return e(d,function(a){g[a[0]]=q(a[1],b)}),f(new a.Environment(g,b),arguments)},"let*":function(b,c,d){var g={},h;return e(d,function(c){g[c[0]]=q(c[1],h),h=new a.Environment(g,b)}),f(h,arguments)},"try":function(a,b,c,d){try{return q(c,a)}catch(e){if(!d)throw e;var f=q(d,a);return f(e)}}},c=function(a,b){this.object=a,this.property=b},d=function(a,b){this.car=a,this.cdr=b};c.prototype={get:function(){return this.object[this.property]},set:function(a){this.object[this.property]=a},toString:function(){return this.get().toString()}},a.Environment=function(a,b){var c;this.entries=a||{},this.outer=b||null,!a&&!b&&(this.entries={js:this,"=":function(a,b){return a===b},"string-append":function(){var a="";return e(arguments,function(b){a+=b}),a},cons:j,apply:function(a,b){return p([a].concat(b))},"new":function(){var a,b,c;this.schemeTemp={constructor:arguments[0].get(),args:Array.prototype.slice.call(arguments,1)},a="new this.schemeTemp.constructor(";for(b=0;b<this.schemeTemp.args.length;b++)b>0&&(a+=","),a+="this.schemeTemp.args["+b+"]";return a+=");",c=this.eval(a),delete this.schemeTemp,c},"make-object":function(a){var b={};return e(a,function(a){b[a.car]=a.cdr}),b}},c=this,e(["+","-","*","/",">","<",">=","<="],function(a){c.entries[a]=function(b,c){return this.eval(b+a+c)}}))},a.Environment.prototype={get:function(a){var b=this.entries[a];return typeof b!="undefined"?b:this.outer?this.outer.get(a):undefined},define:function(a,b){this.entries[a]=b},set:function(a,b){this.outer&&typeof this.outer.get(a)!="undefined"?this.outer.set(a,b):this.define(a,b)}},a.Symbol=function(a){this.s=a},a.Symbol.prototype={toString:function(){return this.s}},a.read=function(a){var b=h(g(a)),c=[];while(b.length)c.push(k(b));return c},a.eval=function(b,d){return m(r(b,d||new a.Environment),function(a){return a instanceof c?a.get():a})},a.print=function(a){var b="";return e(a,function(a){b+=s(a)+"\n"}),b},typeof window!="undefined"&&(window.onload=function(){var b=document.getElementsByTagName("script");e(b,function(b){if(b.type!=="text/x-scheme")return;b.src.length?t(b.src,function(b){a.eval(a.read(b))}):a.eval(a.read(b.innerHTML))})})})(scheme);